<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.nlog-project.org/schemas/NLog.xsd NLog.xsd"
      autoReload="true"
      throwExceptions="false"
      internalLogLevel="Off" internalLogFile="c:\temp\nlog-internal.log" >


	<!-- optional, add some variabeles
		https://github.com/nlog/NLog/wiki/Configuration-file#variables
	-->
	
	<variable name="logPath" value="Logs"/>
	
	<!-- 
		See https://github.com/nlog/nlog/wiki/Configuration-file 
		for information on customizing logging rules and outputs.
	-->
	
	<targets>
		<!--API-Start-->
		<target xsi:type="File"
				name="ApiLogFile"
				fileName="${logPath}\API\${shortdate}.log"
				layout="${all-event-properties:includeEmptyValues=true} ${newline}"
				archiveFileName="${logPath}\Backup.{#}.log"
				archiveNumbering="DateAndSequence"
				archiveEvery="Day"
				encoding="UTF-8"
				maxArchiveFiles="14" />

		<target xsi:type="NLogViewer"
				name="ApiLogViewer"
				newLine="true"
				includeAllProperties="true"
				address="udp://127.0.0.1:9999" />

		<target xsi:type="Database"
				name="ApiLogDatabase"
				dbProvider="System.Data.SqlClient"
				connectionString="Data Source=VNHCMM0SQL41;Initial Catalog=ReferenceApplication;Integrated Security=True;"
				commandText="INSERT INTO [dbo].[SY_API_Logs] ([ActivityId],[TraceId],[HostName],[UserName],[ApplicationId],[ApplicationName],[LogLevel],[Source],[MessageType],[Method],[ContentType],[StatusCode],[Body],[QueryString],[CreatedDate]) VALUES (@ActivityId,@TraceId,@HostName,@UserName,@ApplicationId,@ApplicationName,@LogLevel,@Source,@MessageType,@Method,@ContentType,@StatusCode,@Body,@QueryString,@CreatedDate)">
			<parameter name="@ActivityId" layout="${event-properties:ActivityId}" />
			<parameter name="@TraceId" layout="${event-properties:TraceId}" />
			<parameter name="@HostName" layout="${event-properties:HostName}" />
			<parameter name="@UserName" layout="${event-properties:UserName}" />
			<parameter name="@ApplicationId" layout="${configsetting:item=System.Id}" dbType="Int32" />
			<parameter name="@ApplicationName" layout="${configsetting:item=System.Name}" />
			<parameter name="@LogLevel" layout="${event-properties:LogLevel}" />
			<parameter name="@Source" layout="${event-properties:Source}" />
			<parameter name="@MessageType" layout="${event-properties:MessageType}" />
			<parameter name="@Method" layout="${event-properties:Method}" />
			<parameter name="@ContentType" layout="${event-properties:ContentType}" />
			<parameter name="@StatusCode" layout="${event-properties:StatusCode}" dbType="Int32" />
			<parameter name="@Body" layout="${event-properties:Body:when='${event-properties:Source:uppercase=true}' != '/LOGIN'}" />
			<parameter name="@QueryString" layout="${event-properties:QueryString}" />
			<parameter name="@CreatedDate" layout="${event-properties:CreatedDate}" dbType="DateTime" />
		</target>
		<!--API-End-->

		<!--APP-Start-->
		<target xsi:type="File"
				name="AppLogFile"
				fileName="${logPath}\${shortdate}.log"
				layout="${longdate} ${level} ${message}"
				archiveFileName="${logPath}\Backup.{#}.log"
				archiveNumbering="DateAndSequence"
				archiveEvery="Day"
				encoding="UTF-8"
				maxArchiveFiles="14" />

		<target xsi:type="NLogViewer"
				name="AppLogViewer"
				newLine="true"
				includeAllProperties="true"
				address="udp://127.0.0.1:9999" />

		<target xsi:type="Database"
				name="AppLogDatabase"
				dbProvider="System.Data.SqlClient"
				connectionString="Data Source=VNHCMM0SQL41;Initial Catalog=ReferenceApplication;Integrated Security=True;"
				commandText="INSERT INTO [dbo].[SY_Logs] ([ActivityId],[TraceId],[ApplicationName],[LogLevel],[Source],[Message],[Detail],[CreatedDate]) VALUES (@ActivityId,@TraceId,@ApplicationName,@LogLevel,@Source,@Message,@Detail,@CreatedDate)">
			<parameter name="@ActivityId" layout="${event-properties:ActivityId}" />
			<parameter name="@TraceId" layout="${event-properties:TraceId}" />
			<parameter name="@ApplicationName" layout="${configsetting:item=System.Name}" />
			<parameter name="@LogLevel" layout="${event-properties:LogLevel}" />
			<parameter name="@Source" layout="${event-properties:Source}" />
			<parameter name="@Message" layout="${event-properties:Message}" />
			<parameter name="@Detail" layout="${event-properties:Detail}" />
			<parameter name="@CreatedDate" layout="${event-properties:CreatedDate}" dbType="DateTime" />
		</target>
		<!--APP-End-->
		
		<!-- 
			add your targets here 
			See https://github.com/nlog/NLog/wiki/Targets for possible targets.
			See https://github.com/nlog/NLog/wiki/Layout-Renderers for the possible layout renderers.
		-->

		<!--
			Write events to a file with the date in the filename. 
			<target xsi:type="File" name="f" fileName="${basedir}/logs/${shortdate}.log"
				layout="${longdate} ${uppercase:${level}} ${message}" />
		-->
	</targets>

	<rules>
		<!--<logger name="ApiLog" levels="Error,Info" writeTo="ApiLogFile" final="true" />-->
		<!--<logger name="ApiLog" levels="Error,Info" writeTo="ApiLogViewer" final="true" />-->
		<logger name="ApiLog" levels="Error,Info,Debug" writeTo="ApiLogDatabase" final="true" />

		<!--<logger name="AppLog" minlevel="Debug" writeTo="AppLogFile" />-->
		<!--<logger name="AppLog" minlevel="Debug" writeTo="AppLogViewer" />-->
		<logger name="AppLog" levels="Error,Info,Debug" writeTo="AppLogDatabase" />
	</rules>
</nlog>
